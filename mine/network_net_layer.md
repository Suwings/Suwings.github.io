# 网络层
- 内网 IP 段
	- 10/8    A类
	- 172.16/12   B类
    - 192.168/16     C类
    - E
    - F


关于路由拓扑图（OSPF，RIP）
---------

- 目前
	- 根据目前所有的知识猜想，有时会误认为路由器应该知道整个网络的拓扑图路线
	- 但是事实是，路由器不可能存下整个 Internet 的网络，故此网络指子网。
- 局域网
	- 局域网内路由器将拥有局域网内的拓扑图

- ISP 服务域网
	- 服务域网猜想是，接入整个实体地区的网络到路由器，并且形成一个 ISP 域子网，如果直接在本地区域通讯，即可直接走本域网络线路。
	- 如果非本域网络，如长沙链接深圳的服务器，那么会发现不在本网段，所以会丢去默认路由，即上层子网。
	- 猜想：株洲到北京的链接:“ 市级 -> 长沙 -> 湖南省骨干网 -> 华南骨干网 -> 华北骨干网 ->  北京”

- 本人曾经的误区
	- 原先一直没有明白为什么路由器能知道我数据包的传递方向，因为对于互联网而言，路由器应该不可能知道路线才对。
	- 但是现在，突然明白，有子网的存在，不需要整个互联网的地图，而只需要局部地图即可。

- 更细的划分，区域分层化（BGP，AS协议）
	- 纵使在同一物理机器群上，也可以虚拟划分路由器区域，路由器将不知道外部的拓扑图，减少搜索量。

- 攻击行为：
	- 如果反复的告诉目标系统，您的网关的 MAC 是我的话，那么目标系统的所有数据包都会转发到我的系统。
	- 如果我的系统没有开启流量转发，那么，对方就会断网。
	- Arpsoof: arpspoof.exe 192.168.1.168<目标> 192.168.1.1<网关> 80 <…>
    - 记得，双向欺骗，既要欺骗目标系统，又要欺骗网关。


见得少协议
---------

- ICMP
    - 用于辅助 IP 层探测路由器是否存在，不存在的话则返回一个错误信息。
	- 其中还有一个 TTL 生存时间

- UDP-Lite
	- 轻量级 UDP 传输，不会检查所有错误，快速传输。

- DCCP
	- 崭新的 UDP ，可有阻塞控制的传输，ACK答应，重发等等

- 路由器/NAT
    - 其内部拥有一个转换表，甚至可以用于 IPv6 转换为 IPv4
    - 目标地址 163.221.120.9	
    - 源地址 192.168.1.144	
    - 转换后
    - 目标地址 163.221.120.9	
    - 源地址 自己的公共出口ip	

- 路由器/MPLS（Multi Protocol Label Switching）
    - 标记交换
    - 路由器之间互相转发，需要比较目标 IP，然后选择合适路线转发。
    - 但是如果域网是可靠静态的，可以考虑标记数据包，从而特定路线。
    - 注意：这个与互联网并不兼容。

- 路由器/OSPF
    - 当路由器通电之后，会发送 HELLO 包，检查所有 LAN 口。
    - 当 10 秒内未收到确认（空等几次），则认为对方死亡，那么将发送“链路状态更新”数据包，让所有路由器更新拓扑图。


关于几个 ip 的通俗理解：
---------

- 1，一个ip报文在路由器中寻路是通过报文的目的ip去匹配路由表。
- 2，路由表的键值简单地说包括ip和掩码n，匹配过程是最长路径匹配，也就是说报文优选掩码最长的路由。
- 3，主机路由就是x.x.x.x/32，意思是仅仅到x.x.x.x的报文听我的。
- 4，网络路由就是x.x.x.x/n, 意思是到x.x.x.x/n的报文听我的。
- 5，默认路由是0.0.0.0/0，意思是实在没人要的报文听我的。